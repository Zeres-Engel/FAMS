<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin API Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f8f9fa; }
        .card { margin-bottom: 20px; }
        pre { background-color: #f5f5f5; padding: 10px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
        .endpoint { font-family: monospace; color: #0d6efd; }
        .json-editor { height: 150px; width: 100%; font-family: monospace; }
        .response-area { min-height: 100px; }
        .api-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #ddd; }
        .api-title { background-color: #f0f0f0; padding: 10px; border-radius: 5px; margin-bottom: 15px; }
        .sticky-top { top: 1rem; }
        .status-bar { font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">API Dashboard</a></li>
                <li class="breadcrumb-item active" aria-current="page">Admin API</li>
            </ol>
        </nav>
        
        <div class="alert alert-info mb-3">
            <h5>Thông tin API Admin</h5>
            <p class="mb-0">API dành cho quản trị viên: quản lý và tạo các đối tượng trong hệ thống (học sinh, giáo viên, phụ huynh).</p>
        </div>
        
        <!-- Status bar for authentication info -->
        <div class="card mb-4">
            <div class="card-body status-bar">
                <div class="row">
                    <div class="col-md-6" id="authStatus">
                        <span class="badge bg-warning">Chưa đăng nhập</span>
                    </div>
                    <div class="col-md-6 text-end">
                        <button id="checkAuthBtn" class="btn btn-sm btn-info">Kiểm tra xác thực</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Create User API -->
        <div class="api-section" id="unified-create-section">
            <div class="api-title">
                <h3>Create User API</h3>
                <span class="endpoint">POST /api/admin/users</span>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            Tạo người dùng (Học sinh/Giáo viên)
                        </div>
                        <div class="card-body">
                            <form id="unifiedCreateForm">
                                <div class="mb-3">
                                    <label for="roleField" class="form-label">Loại người dùng</label>
                                    <select class="form-select" id="roleField" required>
                                        <option value="Student">Học sinh</option>
                                        <option value="Teacher">Giáo viên</option>
                                    </select>
                                </div>
                                
                                <!-- Basic User Fields -->
                                <div class="border p-3 mb-3">
                                    <h5>Thông tin cơ bản</h5>
                                    <div class="mb-3">
                                        <label for="firstNameField" class="form-label">Tên</label>
                                        <input type="text" class="form-control" id="firstNameField" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="lastNameField" class="form-label">Họ</label>
                                        <input type="text" class="form-control" id="lastNameField" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="phoneField" class="form-label">Số điện thoại</label>
                                        <input type="text" class="form-control" id="phoneField">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Giới tính</label>
                                        <div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="genderField" id="maleField" value="true" checked>
                                                <label class="form-check-label" for="maleField">Nam</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="genderField" id="femaleField" value="false">
                                                <label class="form-check-label" for="femaleField">Nữ</label>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="passwordField" class="form-label">Mật khẩu</label>
                                        <input type="password" class="form-control" id="passwordField" value="1234">
                                        <small class="text-muted">Mặc định: 1234</small>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="backupEmailField" class="form-label">Email dự phòng (không bắt buộc)</label>
                                        <input type="email" class="form-control" id="backupEmailField">
                                        <small class="text-muted">Email chính sẽ được tự động tạo từ UserID</small>
                                    </div>
                                </div>
                                
                                <!-- Student-specific fields -->
                                <div id="studentFields" class="entity-fields">
                                    <div class="mb-3">
                                        <label for="batchField" class="form-label">Khóa học</label>
                                        <select class="form-select" id="batchField" required>
                                            <option value="">-- Chọn khóa học --</option>
                                            <!-- Batch options will be loaded dynamically -->
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="addressField" class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control" id="addressField">
                                    </div>
                                    <div class="mb-3">
                                        <label for="dobField" class="form-label">Ngày sinh</label>
                                        <input type="date" class="form-control" id="dobField">
                                    </div>
                                    
                                    <!-- Parent section -->
                                    <div class="border p-3 mb-3">
                                        <h5>Thông tin phụ huynh <button type="button" id="addParentBtn" class="btn btn-sm btn-primary">+ Thêm phụ huynh</button></h5>
                                        
                                        <div id="parentsContainer">
                                            <!-- Parent 1 (default) -->
                                            <div class="parent-entry border-bottom pb-2 mb-3">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h6 class="mb-0">Phụ huynh #1</h6>
                                                    <button type="button" class="btn btn-sm btn-outline-danger remove-parent-btn" style="display:none;">Xóa</button>
                                                </div>
                                                
                                                <!-- Manual parent info entry -->
                                                <div class="manual-parent-info">
                                                    <div class="row mb-2">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Họ tên phụ huynh</label>
                                                            <input type="text" class="form-control parent-name">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Số điện thoại</label>
                                                            <input type="text" class="form-control parent-phone">
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="row mb-2">
                                                        <div class="col-md-6">
                                                            <label class="form-label">Nghề nghiệp</label>
                                                            <input type="text" class="form-control parent-career">
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label">Giới tính</label>
                                                            <div>
                                                                <div class="form-check form-check-inline">
                                                                    <input class="form-check-input parent-gender" type="radio" name="parentGender1" value="true" checked>
                                                                    <label class="form-check-label">Nam</label>
                                                                </div>
                                                                <div class="form-check form-check-inline">
                                                                    <input class="form-check-input parent-gender" type="radio" name="parentGender1" value="false">
                                                                    <label class="form-check-label">Nữ</label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Teacher-specific fields -->
                                <div id="teacherFields" class="entity-fields" style="display:none;">
                                    <div class="mb-3">
                                        <label for="teacherIdField" class="form-label">Teacher ID</label>
                                        <input type="text" class="form-control" id="teacherIdField" placeholder="Leave empty for auto-generation">
                                        <small class="text-muted">Leave empty to auto-generate a unique ID</small>
                                    </div>
                                    <div class="mb-3">
                                        <label for="teacherAddressField" class="form-label">Địa chỉ</label>
                                        <input type="text" class="form-control" id="teacherAddressField">
                                    </div>
                                    <div class="mb-3">
                                        <label for="teacherDobField" class="form-label">Ngày sinh</label>
                                        <input type="date" class="form-control" id="teacherDobField">
                                    </div>
                                    <div class="mb-3">
                                        <label for="majorField" class="form-label">Chuyên ngành</label>
                                        <div class="input-group">
                                            <input type="text" class="form-control" id="majorField">
                                            <button class="btn btn-outline-secondary" type="button" id="addMajorBtn">+</button>
                                        </div>
                                        <div id="majorList" class="mt-2">
                                            <!-- Majors will be added here dynamically -->
                                        </div>
                                        <input type="hidden" id="majorListInput" value="">
                                    </div>
                                    <div class="mb-3">
                                        <label for="weeklyCapacityField" class="form-label">Số giờ dạy/tuần</label>
                                        <input type="number" class="form-control" id="weeklyCapacityField" value="10">
                                    </div>
                                </div>
                                
                                <div class="alert alert-info">
                                    <small>Lưu ý: UserID và Email sẽ được tự động tạo dựa trên thông tin người dùng</small>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">Tạo mới</button>
                            </form>
                            
                            <div class="mt-3 response-area" id="unified-create-response-message">
                                <!-- Response message will be displayed here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-secondary text-white">
                            Raw JSON Request
                        </div>
                        <div class="card-body">
                            <textarea id="unified-create-json" class="json-editor">{
  "role": "Student",
  "firstName": "Minh",
  "lastName": "Nguyễn",
  "phone": "0912345678",
  "address": "Hà Nội",
  "dateOfBirth": "2010-01-01",
  "gender": true,
  "classId": 1,
  "batchId": 3
}</textarea>
                            <button id="unified-create-execute" class="btn btn-secondary mt-2">Execute</button>
                            
                            <div class="mt-3">
                                <h6 class="text-muted">Response:</h6>
                                <pre id="unified-create-response" class="response-area">// Kết quả API sẽ hiển thị ở đây</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- User List API -->
        <div class="api-section" id="user-list-section">
            <div class="api-title">
                <h3>User List API</h3>
                <span class="endpoint">GET /api/admin/users/:type</span>
            </div>
            
            <div class="row">
                <div class="col-md-7">
                    <div class="card">
                        <div class="card-header bg-primary text-white">
                            Danh sách người dùng
                        </div>
                        <div class="card-body">
                            <!-- User type selector tabs -->
                            <ul class="nav nav-tabs mb-3" id="userTypeTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="student-tab" data-bs-toggle="tab" data-type="student" type="button" role="tab" aria-controls="student" aria-selected="true">Học sinh</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="teacher-tab" data-bs-toggle="tab" data-type="teacher" type="button" role="tab" aria-controls="teacher" aria-selected="false">Giáo viên</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="parent-tab" data-bs-toggle="tab" data-type="parent" type="button" role="tab" aria-controls="parent" aria-selected="false">Phụ huynh</button>
                                </li>
                            </ul>
                            
                            <!-- Filter options -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="userSearchInput" placeholder="Tìm kiếm...">
                                        <button class="btn btn-outline-secondary" type="button" id="userSearchButton">
                                            <i class="bi bi-search"></i> Tìm
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <select class="form-select" id="userFilterSelect">
                                        <option value="">-- Lọc --</option>
                                        <!-- Filter options will be populated based on user type -->
                                    </select>
                                </div>
                            </div>
                            
                            <!-- User list table -->
                            <div class="table-responsive">
                                <table class="table table-striped table-hover" id="userListTable">
                                    <thead>
                                        <tr id="userTableHeader">
                                            <th>Thao tác</th>
                                            <!-- Table headers will be dynamically populated -->
                                        </tr>
                                    </thead>
                                    <tbody id="userTableBody">
                                        <!-- Table data will be dynamically populated -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <!-- Pagination -->
                            <nav aria-label="User list pagination">
                                <ul class="pagination justify-content-center" id="userListPagination">
                                    <!-- Pagination will be dynamically populated -->
                                </ul>
                            </nav>
                            
                            <!-- Loading indicator -->
                            <div class="text-center d-none" id="userListLoading">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Đang tải...</span>
                                </div>
                                <p class="text-muted mt-2">Đang tải dữ liệu...</p>
                            </div>
                            
                            <!-- Empty state message -->
                            <div class="alert alert-info d-none" id="userListEmpty">
                                Không có dữ liệu người dùng để hiển thị.
                            </div>
                            
                            <!-- Error message -->
                            <div class="alert alert-danger d-none" id="userListError">
                                Đã xảy ra lỗi khi tải dữ liệu.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-5">
                    <div class="card">
                        <div class="card-header bg-secondary text-white">
                            Raw JSON Request
                        </div>
                        <div class="card-body">
                            <textarea id="user-list-json-request" class="json-editor">{
  "type": "student",
  "search": "",
  "page": 1,
  "limit": 10,
  "filter": ""
}</textarea>
                            <button id="user-list-execute" class="btn btn-secondary mt-2">Execute</button>
                            
                            <div class="mt-3">
                                <h6 class="text-muted">Response:</h6>
                                <pre id="user-list-response" class="response-area">// Kết quả API sẽ hiển thị ở đây</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- API Response -->
        <div class="card mt-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">API Response</h5>
            </div>
            <div class="card-body">
                <pre id="response">Kết quả sẽ hiển thị ở đây...</pre>
            </div>
        </div>
    </div>

    <!-- New Batch Modal -->
    <div class="modal fade" id="newBatchModal" tabindex="-1" aria-labelledby="newBatchModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newBatchModalLabel">Tạo khóa học mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newBatchForm">
                        <div class="mb-3">
                            <label for="batchNameField" class="form-label">Tên khóa học</label>
                            <input type="text" class="form-control" id="batchNameField" placeholder="Khóa 2024-2027">
                        </div>
                        <div class="mb-3">
                            <label for="startYearField" class="form-label">Năm bắt đầu</label>
                            <input type="number" class="form-control" id="startYearField" required placeholder="2024">
                        </div>
                        <div class="mb-3">
                            <label for="endYearField" class="form-label">Năm kết thúc</label>
                            <input type="number" class="form-control" id="endYearField" required placeholder="2027">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" id="createBatchBtn">Tạo khóa học</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Import modular JS instead of embedded script -->
    <script type="module" src="/js/admin/admin.js"></script>
</body>
</html> 